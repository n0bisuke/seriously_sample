<!DOCTYPE html>
<html>
<head>
  <title>Seriously.js Channels Example</title>
  <style type="text/css">
  img, video {
    display: none;
  }
  </style>
</head>
<body>
  <!-- <img src="./pencils.jpg" id="pencils"/> -->
  <!-- <img src="./robot.jpg" id="robot"/> -->
  <video src="./video/boy2.mov" id="robot" autoplay></video>
  <video src="./video/boy.m4v" id="pencils" autoplay></video>

  <canvas id="canvas" width="640" height="619"></canvas>
  <script src="./js/require.js"></script>
  <script>
  require.config({
    baseUrl: './js'
  });

  require([
    'seriously',
    'effects/seriously.channels',
    'effects/seriously.blend'
    ], function (Seriously) {
      // declare our variables
      var seriously, // the main object that holds the entire composition
      channels, // a split effect
      blend,
      target, // a wrapper object for our target canvas
      scaleRobot,
      scalePencils,

      moveMask,
      resizeMask,
      mask = document.createElement('canvas'),
      ctx = mask.getContext('2d');

      seriously = new Seriously();
      target = seriously.target('#canvas');
      channels = seriously.effect('channels');
      blend = seriously.effect('blend');

      scaleRobot = seriously.transform('2d');
      scaleRobot.source = seriously.source('#robot');
      scaleRobot.scale(640/989);

      scalePencils = seriously.transform('reformat');
      scalePencils.source = seriously.source('#pencils');
      scalePencils.width = 640;
      scalePencils.height = 619;
      scalePencils.mode = 'cover';

      //draw mask
      mask.width = 100;
      mask.height = 100;

      ctx.fillColor = 'black';
      ctx.fillRect(0, 0, 400, 400);
      ctx.fillStyle = 'white';
      ctx.fillRect(0, 0, 160, 160);

      resizeMask = seriously.transform('reformat');
      resizeMask.source = mask;
      resizeMask.width = target.width;
      resizeMask.height = target.height;

      moveMask = seriously.transform();
      moveMask.source = resizeMask;
      // moveMask.rotation = 30;
      moveMask.scale(1);

      channels.source = scaleRobot;
      channels.alphaSource = moveMask;
      channels.alpha = 'red';
      channels.blue = 'green';
      channels.green = 'blue';

      blend.bottom = scalePencils;
      blend.top = channels;

      target.source = blend;

      window.addEventListener('mousemove', function (evt) {
        var canvas = target.original,
        x = evt.pageX - canvas.offsetLeft,
        y = evt.pageY - canvas.offsetTop;

        moveMask.translateX = x - canvas.width / 2;
        moveMask.translateY = canvas.height / 2 - y;
      }, false);

      seriously.go(function (now) {
        // moveMask.rotation = (now % 18000) / 50;
      });
    });
  </script>
</body>
</html>
